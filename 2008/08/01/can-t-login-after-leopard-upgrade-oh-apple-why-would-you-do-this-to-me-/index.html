<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Can't login after Leopard Upgrade. Oh Apple, why would you do this to me? </title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Andrew's Website woot!">
    <link rel="canonical" href="http://andrewmccall.com/2008/08/01/can-t-login-after-leopard-upgrade-oh-apple-why-would-you-do-this-to-me-/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

</head>


    <body>

    <header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/">andrewmccall.com</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
          <a class="page-link" href="/about/">About</a>
        
          <a class="page-link" href="/feed.xml"></a>
        
          <a class="page-link" href="/"></a>
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Can't login after Leopard Upgrade. Oh Apple, why would you do this to me? </h1>
    <p class="meta">Aug 1, 2008</p>
  </header>

  <article class="post-content">
  I wanted to write something else today, but instead I'm recovering my laptop because I decided to "quickly" upgrade from Tiger to Lepoard this morning. Everything looked to be going perfectly and I figured I'd got away without any major problems - that is until I tried to login. 

Unfortunately there is an all too common bug with upgrading a system that has a filevault user - in short it doesn't fucking work! I'm the only user on my laptop and when I tried to log in after the upgrade all I got was an error message: 

<blockquote class="posterous_short_quote">"Your FileVault-protected home folder did not open and needs to be repaired. Click OK to repair the folder and continue logging in. Click Cancel Login to log in as a different user" </blockquote>

<strong>oh fuck</strong>. 

I'd like this part of the story to be the part where I say, it's all ok because I had backups, but it's not. I had my daughter in my arms and was flying one handed, she'd just dozed off for a short nap and I didn't want to wake her up so I didn't reach down, unplug the external drive from my desktop machine, I didn't plug it into my laptop and I didn't back up my files. 

<strong>oh fuck</strong>. 

I clicked OK, waited a few seconds and hoped for the best...

<blockquote class="posterous_short_quote">"Logging into the account failed because an error occurred"</blockquote>

<strong>oh fuck</strong>. 

Now it sinks in, what was meant to be a nice little morning project, upgrade my OS has turned into a total nightmare. Here are the steps to sort it out, they worked for me and hopefully will help someone else. 

<h1>Reset the root password, so you can login</h1>

Restart you machine with the install disk in the drive and hold the <strong>c</strong> key to boot from the disk. 

Select your instalation language, accept the agreements and click continue. When it's loaded choose reset password from the utilities list. Choose your system drive and select <em>System Administrator (root)</em> from the list of users. Set a password and click save. 

<h1>Login as root</h1>

Close all the windows and quit the Mac OS X Installer, when your prompted to select a startup disk choose your hard disk. 

Now you login screen should have an option to log in as another user, pick this and use the username root and the password you set above. You should now get a new desktop from here you'll be able to recover your files. 

<h1>Get your files</h1>

Open finder and browse to the Users folder. Find your user and in there you should find a file called <em>username</em>.sparseimage. 

I tried to back the whole file up to my external drive, but couldn't get it to copy in either Finder or terminal.

So just double click it to mount it as a disk. You'll be asked to type a password, it's your user password for the account. Type it and click ok. 

Finder will start to mount the disk then stop with the following message:

[[posterous-content:rmwCBzHoHbAzHynFntja]]

You've got nothing to lose here, it's mount it or lose everything so just go ahead and click Open. 

[[posterous-content:bseEujfzkIrcoDisDuIk]]

So it can't read it properly, just click ok. You should now have a drive mounted and it has all your files in there. Time to back them all up, except they probably won't all back up. I tried that and got some permission issues, rather then worry too much about them I ignored them and just made sure I got all my documents, pictures, music, movies and the application settings I wanted, I ignored everything else. 

I have a lot of files and this took a very long time, the lesson I've learned - back up more often. Ironically that's part of the reason I wanted to upgrade, so timemachine would do this for me... but I digress. 

<h1>Recover</h1>

At this point you have a choice. You can create a new users, move files into it and move on with your upgraded system. Since I was tempted to wipe the system and start again when I considered installing the OS I chose to go that route. I rebooted, used disk utility to clean the drive and started again from fresh. 

Either way from you backups and your new user you should be able to either do a recovery and get more or less back to where you wanted to be.  

<h1>Rant</h1>

Filevault is promoted as a great security feature of the OS. I like it, I deal with the fact that my machine is somewhat slower for using it, but I feel the benefits if for any reason my laptop is lost or stolen far outweigh the inconviniences. 

I haven't really had any problems with my mac before now and I don't see any reason that my system should be anything but standard. Since I'm <a href="http://discussions.apple.com/thread.jspa?messageID=5881960">not the only one that has been experiencing these issues</a>, one can only assume it's fairly widespread. 

If only I'd know, I could have saved myself hours by simply turning file vault off. I mean I took the trouble to reboot once and clean up my home directory so the OS could fully recover it's space.

To anyone reading this contemplating an upgrade, <strong>TURN FILEVAULT OFF FIRST!</strong>

<h1>The good news</h1>

The only good to come from the whole experience is that I ended up with the clean install I kinda wanted anyway. Though not really through choice. 

Also next time I'll be running a simple google search for "snow lepoard upgrade problems" first and hopefully timemachine means I'll have consistent backups, before I start.

  </article>

</div>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <h2 class="footer-heading">andrewmccall.com</h2>

    <div class="footer-col-1 column">
      <ul>
        <li>andrewmccall.com</li>
        <li><a href="mailto:andrew@andrewmccall.com">andrew@andrewmccall.com</a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username"></span>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
                c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
                c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
                C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
                c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
                c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
              </svg>
            </span>
            <span class="username"></span>
          </a>
        </li>
      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text">Andrew's Website woot!</p>
    </div>

  </div>

</footer>


    </body>
</html>