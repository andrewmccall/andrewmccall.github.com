<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Integration Testing in Maven - With Maven, Cargo, Httpunit and Selenium</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Andrew's Website woot!">
    <link rel="canonical" href="http://andrewmccall.com/2008/09/22/integration-testing-in-maven-with-maven-cargo-httpunit-and-selenium/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

</head>

    <body>

    <header class="site-header">

  <div class="wrap">

    <a class="site-title" href="/">andrewmccall.com</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
          <a class="page-link" href="/about/">About</a>
        
          <a class="page-link" href="/feed.xml"></a>
        
          <a class="page-link" href="/"></a>
        
      </div>
    </nav>

  </div>

</header>

    <div class="page-content">
      <div class="wrap">
      <div class="post">

  <header class="post-header">
    <h1>Integration Testing in Maven - With Maven, Cargo, Httpunit and Selenium</h1>
    <p class="meta">Sep 22, 2008</p>
  </header>

  <article class="post-content">
  I've been trying to figure this out for months, and thought it should have been simple. All I wanted to do was write a set of unit tests to test my java code, have them run whenever I hit test. Next I wanted to have a set of HTTP Unit, Selenium or similar tests run to test that the actual application is working when it's built and deployed to a container using the cargo plugin.

I didn't really want to have a separate project to do this because it seemed like a massive pain in the ass to maintain the whole thing. I didn't see any reason why it shouldn't be easy with Maven either - it does have a phase for integration-tests already.

My first try looked good to me:

&nbsp;

<code>
<div class="CodeRay">
  <div class="code"><pre>...
&lt;build&gt;
    ...
    &lt;plugins&gt;
        ...
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
            &lt;configuration&gt;
                &lt;excludes&gt;
                    &lt;exclude&gt;**/integration/**&lt;/exclude&gt;
                &lt;/excludes&gt;
            &lt;/configuration&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;id&gt;integrationtest&lt;/id&gt;
                    &lt;phase&gt;integration-test&lt;/phase&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;test&lt;/goal&gt;
                    &lt;/goals&gt;
                    &lt;configuration&gt;
                        &lt;excludes&gt;
                            &lt;exclude&gt;none&lt;/exclude&gt;
                        &lt;/excludes&gt;
                        &lt;includes&gt;
                            &lt;include&gt;**/integration/**/*Test*.java&lt;/include&gt;
                            &lt;include&gt;**/integration/**/*Test.java&lt;/include&gt;
                            &lt;include&gt;**/integration/**/*TestCase.java&lt;/include&gt;
                        &lt;/includes&gt;
                    &lt;/configuration&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
        &lt;/plugin&gt;
        ...
    &lt;/plugins&gt;
    ...
&lt;/build&gt;
...</pre></div>
</div>

</code>

&nbsp;

I tried to run the tests, but unfortunately when it gets to the second round of tests - which should run my integration tests - it runs the same sets of as it ran the first time. I tried adding the <code>combine.children="append"</code> attribute to the includes, and excludes but that didn't work either. Finally I came across a source file <a href="http://plexus.codehaus.org/plexus-utils/xref/org/codehaus/plexus/util/xml/Xpp3Dom.html">XppDom</a>, part of plexus which maven uses. XppDom allowed the combine.children attribute as well as another I haven't seen mentioned anywhere else <code>childMergeOverride</code>. I added that instead and it worked!

&nbsp;

<code>
<div class="CodeRay">
  <div class="code"><pre>...
&lt;build&gt;
    ...
    &lt;plugins&gt;
        ...
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
            &lt;configuration&gt;
                &lt;excludes&gt;
                    &lt;exclude&gt;**/integration/**&lt;/exclude&gt;
                &lt;/excludes&gt;
            &lt;/configuration&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;id&gt;integrationtest&lt;/id&gt;
                    &lt;phase&gt;integration-test&lt;/phase&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;test&lt;/goal&gt;
                    &lt;/goals&gt;
                    &lt;configuration&gt;
                        &lt;excludes childMergeOverride=&quot;true&quot;&gt;
                            &lt;exclude&gt;none&lt;/exclude&gt;
                        &lt;/excludes&gt;
                        &lt;includes childMergeOverride=&quot;true&quot;&gt;
                            &lt;include&gt;**/integration/**/*Test*.java&lt;/include&gt;
                            &lt;include&gt;**/integration/**/*Test.java&lt;/include&gt;
                            &lt;include&gt;**/integration/**/*TestCase.java&lt;/include&gt;
                        &lt;/includes&gt;
                    &lt;/configuration&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
        &lt;/plugin&gt;
        ...
    &lt;/plugins&gt;
    ...
&lt;/build&gt;
...</pre></div>
</div>

</code>

&nbsp;

&nbsp;
<h2>Setting it up for Cargo</h2>
I've done this on a few projects, the first was a project that built a series of taglibs which are used across a number of applications. The release for the project is a jar so I have a separate test web-app structure in <code>${baseDir}/src/test/web-app</code>.  The code for generating this war looks like this:

&nbsp;

<code>
<div class="CodeRay">
  <div class="code"><pre>...
&lt;build&gt;
    ...
    &lt;plugins&gt;
        ...
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;id&gt;generate-test-war&lt;/id&gt;
                    &lt;phase&gt;pre-integration-test&lt;/phase&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;war&lt;/goal&gt;
                    &lt;/goals&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
            &lt;configuration&gt;
                &lt;warSourceDirectory&gt;${basedir}/src/test/webapp&lt;/warSourceDirectory&gt;
                &lt;warName&gt;${project.artifactId}-test&lt;/warName&gt;
                &lt;webappDirectory&gt;${basedir}/target/${project.artifactId}-test&lt;/webappDirectory&gt;
                &lt;primaryArtifact&gt;false&lt;/primaryArtifact&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
        ...
    &lt;/plugins&gt;
    ...
&lt;/build&gt;
...</pre></div>
</div>

</code>

&nbsp;

During the pre-integration-test phase the above simple generates a test war. If you're project is a web-app and it already generates a war you can skip the above as one will be generated for you already.

The next step for was then to get Cargo to deploy the application:

&nbsp;

<code>
<div class="CodeRay">
  <div class="code"><pre>...
&lt;build&gt;
    ...
    &lt;plugins&gt;
        ...
        &lt;plugin&gt;
            &lt;groupId&gt;org.codehaus.cargo&lt;/groupId&gt;
            &lt;artifactId&gt;cargo-maven2-plugin&lt;/artifactId&gt;
            &lt;configuration&gt;
                &lt;wait&gt;false&lt;/wait&gt;
                &lt;container&gt;
                    &lt;containerId&gt;tomcat5x&lt;/containerId&gt;
                    &lt;zipUrlInstaller&gt;
                        &lt;url&gt;${integrationtests.tomcatURL}&lt;/url&gt;
                        &lt;installDir&gt;${installDir}&lt;/installDir&gt;
                    &lt;/zipUrlInstaller&gt;
                    &lt;output&gt;
                        ${project.build.directory}/tomcat5x.log
                    &lt;/output&gt;
                    &lt;log&gt;${project.build.directory}/cargo.log&lt;/log&gt;
                &lt;/container&gt;
                &lt;configuration&gt;
                    &lt;home&gt;
                        ${project.build.directory}/tomcat5x/container
                    &lt;/home&gt;
                    &lt;properties&gt;
                        &lt;cargo.logging&gt;high&lt;/cargo.logging&gt;
                        &lt;cargo.servlet.port&gt;8080&lt;/cargo.servlet.port&gt;
                    &lt;/properties&gt;
                &lt;/configuration&gt;
            &lt;/configuration&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;id&gt;start-container&lt;/id&gt;
                    &lt;phase&gt;pre-integration-test&lt;/phase&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;start&lt;/goal&gt;
                        &lt;goal&gt;deploy&lt;/goal&gt;
                    &lt;/goals&gt;
                    &lt;configuration&gt;
                        &lt;wait&gt;false&lt;/wait&gt;
                        &lt;deployer&gt;
                            &lt;deployables&gt;
                                &lt;deployable&gt;
                                    &lt;location&gt;${basedir}/target/${project.artifactId}-test.war&lt;/location&gt;
                                    &lt;type&gt;war&lt;/type&gt;
                                    &lt;pingURL&gt;http://localhost:8080/${project.artifactId}-test/index.html&lt;/pingURL&gt;
                                    &lt;pingTimeout&gt;300000&lt;/pingTimeout&gt;
                                    &lt;properties&gt;
                                        &lt;context&gt;${project.artifactId}-test&lt;/context&gt;
                                    &lt;/properties&gt;
                                &lt;/deployable&gt;
                            &lt;/deployables&gt;
                        &lt;/deployer&gt;
                    &lt;/configuration&gt;
                &lt;/execution&gt;
                &lt;execution&gt;
                    &lt;id&gt;stop-container&lt;/id&gt;
                    &lt;phase&gt;post-integration-test&lt;/phase&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;stop&lt;/goal&gt;
                    &lt;/goals&gt;
                &lt;/execution&gt;
            &lt;/executions&gt;
        &lt;/plugin&gt;
        ...
    &lt;/plugins&gt;
    ...
&lt;/build&gt;
...</pre></div>
</div>

</code>
Most of this is pretty self explanatory, I try to use parameters to configure as much as I can and try to maintain it in higher level POMs wherever appropriate. This is especially true for the tomcat URL which changes on a regular basis. The seem to post new releases and remove the older ones, and it can be a chore to keep up in multiple projects. You may want to look at the cargo plugin documentation, you can ignore some of what I'm doing above if you're project's default artifact (the one package creates) is a web-app.&nbsp;

So there you have it, eventually I got there after a lot of digging. I've been pretty brief in my explanations and have assumed a fairly good understanding of maven. if you have any questions by all means leave a comment and I'll do my best to make it clearer.<h6 class="zemanta-related-title" style="font-size: 1em;">Related articles by Zemanta</h6><ul class="zemanta-article-ul">
<li class="zemanta-article-ul-li"><a href="http://devlicio.us/blogs/casey/archive/2008/10/01/testing-is-not-technically-hard-it-is-hard-because-it-requires-clear-thought-and-understanding.aspx">Testing Is Not Technically Hard, It Is Hard Because It Requires Clear Thought and Understanding</a></li>
<li class="zemanta-article-ul-li"><a href="http://www.sergiutruta.com/2008/01/22/why-do-we-not-write-tests/">Why do we (not) write tests</a></li>
</ul>

<div class="zemanta-pixie" style="margin-top: 10px; height: 15px;">[[posterous-content:xEkrcgitujefewHaqcIv]]</div>

  </article>

</div>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">

    <h2 class="footer-heading">andrewmccall.com</h2>

    <div class="footer-col-1 column">
      <ul>
        <li>andrewmccall.com</li>
        <li><a href="mailto:andrew@andrewmccall.com">andrew@andrewmccall.com</a></li>
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username"></span>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
                c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
                c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
                C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
                c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
                c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
              </svg>
            </span>
            <span class="username"></span>
          </a>
        </li>
      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text">Andrew's Website woot!</p>
    </div>

  </div>

</footer>

    </body>
</html>